---
title: Tor Relay
author: Neel Chauhan
contributors: Steven Spencer
tested_with: 8.7, 9.2
tags:
  - proxy
  - proxies
---

# Tor relay

## Вступ

[Tor](https://www.torproject.org/) — це служба анонімності та програмне забезпечення, яке направляє трафік через три сервери, що працюють на волонтерах і називаються ретрансляторами. Конструкція з трьома стрибками забезпечує конфіденційність шляхом протидії спробам стеження.

## Передумови та припущення

Нижче наведено мінімальні вимоги для використання цієї процедури:

- Загальнодоступна IP-адреса, безпосередньо на сервері чи з переадресацією портів.
- Система, яка може працювати 24/7, була б корисною для мережі Tor.
- Можливість запускати команди від імені користувача root або використовувати `sudo` для підвищення привілеїв.
- Знайомство з редактором командного рядка. Автор використовує `vi` або `vim` тут, але замініть у вашому улюбленому редакторі.
- Комфорт зі зміною налаштувань SELinux і брандмауера.
- Необліковане з’єднання або з’єднання з високим обмеженням пропускної здатності.

## Встановлення Tor

Щоб інсталювати Tor, вам потрібно спочатку встановити EPEL (додаткові пакети для Enterprise Linux) і запустити оновлення:

```bash
dnf -y install epel-release && dnf -y update
```

Потім встановіть Tor:

```bash
dnf -y install tor
```

## Налаштування Tor

Після встановлення пакетів вам потрібно налаштувати Tor. Автор використовує для цього `vi`, але якщо ви віддаєте перевагу `nano` або щось інше, замініть його в:

```bash
vi /etc/tor/torrc
```

Типовий файл `torrc` є досить описовим, але може бути довгим, якщо вам просто потрібна ретрансляція Tor. Мінімальна конфігурація реле схожа на цю:

```bash
Nickname TorRelay
ORPort 9001
ContactInfo you@example.com
Log notice syslog
```

### Придивляючись ближче

- «Псевдонім» — це (неунікальний) псевдонім для вашого ретранслятора Tor.
- «ORPort» — це порт TCP, який прослуховує ваш ретранслятор Tor. Типовим є "9001".
- «ContactInfo» — це ваша контактна інформація, якщо виникнуть проблеми з вашим реле Tor. Установіть це як свою електронну адресу.
- «Журнал» — це серйозність і призначення ваших журналів ретрансляції Tor. Ми записуємо «повідомлення», щоб запобігти реєстрації конфіденційної інформації, і «syslog» для виведення в журнал «systemd».

### Конфігурація системи

Якщо ви вибрали інший порт TCP/IP, відмінний від "9001" (за замовчуванням), вам потрібно буде налаштувати SELinux `tor_port_t`, щоб додати в білий список порт вашого ретранслятора Tor. Для цього:

```bash
semanage port -a -t tor_port_t -p tcp 12345
```

Замініть "12345" портом TCP, який ви встановили у своєму "ORPort".

Вам також потрібно буде відкрити порт «ORPort» у брандмауері. Для цього:

```bash
firewall-cmd --zone=public --add-port=9001/tcp
firewall-cmd --runtime-to-permanent
```

Замініть «9001» портом TCP, який ви встановили у своєму «ORPort».

## Обмеження пропускної здатності

Якщо ви не хочете виділяти всю свою пропускну здатність для Tor, скажімо, у вас є політика добросовісного використання у вашого провайдера, ви можете обмежити свою пропускну здатність. Ви можете обмежити пропускну здатність (наприклад, 100 мегабіт) або трафік за певний період часу (наприклад, 5 Гб на день).

Для цього відредагуйте файл `torrc`:

```bash
vi /etc/tor/torrc
```

Якщо ви хочете обмежити пропускну здатність, вам потрібно буде додати такий рядок до вашого файлу `torrc`:

```bash
RelayBandwidthRate 12500 KB
```

Це забезпечить пропускну здатність 12500 Кбайт на секунду, тобто близько 100 мегабіт на секунду.

Якщо ви віддаєте перевагу передачі певного обсягу трафіку за певний період часу, скажімо, за день, замість цього додайте наступне:

```bash
AccountingStart day 00:00
AccountingMax 20 GB
```

Ці значення означають, що:

- Ваш обліковий період пропускної здатності починається щодня о 00:00 за системним часом. Ви також можете змінити «день» на «тиждень» або «місяць» або замінити «00:00» іншим часом.
- У вашому обліковому періоді пропускної здатності ви передасте 20 ГБ. Збільште або зменшіть значення, якщо ви хочете дозволити більшу або меншу пропускну здатність для вашого реле.

Що відбувається після того, як ви використовуєте вказану пропускну здатність? Ваше реле блокуватиме нові спроби підключення до кінця періоду. Якщо ваше реле не використовувало вказану смугу пропускання протягом вашого періоду, лічильник буде скинуто без будь-яких простоїв.

## Перевірка та запуск

Після встановлення конфігурації реле Tor наступним кроком є увімкнення демона Tor:

```bash
systemctl enable --now tor
```

У ваших журналах systemd ви повинні отримати такий рядок:

```bash
14 січня 15:46:36 ім’я хосту tor[1142]: 14 січня 15:46:36.000 [повідомлення] Самотестування вказує на те, що ваш ORPort A.B.C.D:9001 доступний ззовні. Чудово. Дескриптор сервера публікації.
```

Це означає, що ваше реле доступне.

Протягом кількох годин ваш ретранслятор буде відображено в списку [Статус реле Tor](https://metrics.torproject.org/rs.html), якщо ви введете свій псевдонім або публічну IP-адресу.

## Міркування про реле

Ви також можете розширити конфігурацію, щоб зробити ваше реле Tor вихідним або мостовим реле.

Ретранслятори виходу є останнім стрибком у схемі Tor, яка підключається безпосередньо до веб-сайтів. Мостові ретранслятори – це ретранслятори, які не входять до списку, які допомагають користувачам із інтернет-цензурою підключатися до Tor.

Параметри для файлу `torrc` знаходяться на [сторінці довідки](https://2019.www.torproject.org/docs/tor-manual.html.en).

Ви також можете налаштувати максимум 8 ретрансляторів на одну публічну IP-адресу. Файл модуля Tor systemd у EPEL не призначений для кількох екземплярів, але файл модуля можна скопіювати та змінити для налаштування кількох реле.

!!! warning "Важливо"

```
Якщо ви плануєте запустити реле виходу, переконайтеся, що ваш інтернет-провайдер або хостингова компанія це влаштовує. Скарги на зловживання від вихідних ретрансляторів дуже поширені, оскільки це останній вузол схеми Tor, який підключається безпосередньо до веб-сайтів від імені користувачів Tor. З цієї причини багато хостингових компаній забороняють реле виходу Tor.

Якщо ви не впевнені, що ваш інтернет-провайдер дозволяє вихідні реле Tor, перегляньте умови обслуговування або запитайте свого інтернет-провайдера. Якщо ваш інтернет-провайдер відповість «ні», зверніться до іншого інтернет-провайдера чи хостингової компанії або розгляньте проміжний ретранслятор.
```

## Висновок

На відміну від звичайних служб VPN, Tor використовує переваги ретрансляторів, які запускаються волонтерами, для забезпечення конфіденційності та анонімності, які ви щойно налаштували.

Хоча для роботи ретранслятора Tor потрібна надійна система, а для виходів — провайдер, що підтримує Інтернет, додавання додаткових реле сприяє конфіденційності, роблячи Tor швидшим із меншою кількістю точок збою.
