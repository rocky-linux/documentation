---
title: 1. основи хмарної ініціалізації
author: Wale Soyinka
contributors: Steven Spencer, Ganna Zhyrnova
tags:
  - cloud-init
  - cloud
  - automation
---

## Архітектура першого завантаження

У цьому посібнику розглядається `cloud-init`, основний інструмент для автоматизації початкового налаштування ваших хмарних екземплярів Rocky Linux 10. Коли ми говоримо про розгортання серверів у хмарі — або навіть у вашій локальній лабораторії віртуалізації — ми часто сприймаємо як належне майже миттєвий перехід від чистого образу до повністю функціональної, готової до мережі машини. Цей подвиг цифрової алхімії виконує одна невпинна утиліта: cloud-init.

## 1. Загадка бутстрепінгу

### Проблема: Коли сервер прокидається сліпим

Уявіть собі звичайний образ Rocky Linux 10 QCOW2. Це ідеальна, незаймана копія, яка не знає свого кінцевого призначення. Він не знає свого імені хоста, який обліковий запис користувача повинен мати доступ через SSH, у якому часовому поясі він знаходиться, або чи потрібен йому Apache чи NGINX.

Якби ви розгортали фізичне обладнання, системний адміністратор вручну налаштував би всі ці параметри. Але в хмарі сервери тимчасові, їх кількість збільшується та зменшується тисячами. Нам потрібен стандартизований, універсальний та надійний механізм для введення необхідного контексту в це порожнє зображення під час першого завантаження.

Цю проблему вирішує **cloud-init**.

### Що таке cloud-init?

Простіше кажучи, Cloud-Init — це стандартний багатопрофільний пакет, який обробляє ранню ініціалізацію хмарних екземплярів. Це основна служба, яка відповідає за створення загального образу (наприклад, того, який ми використовуємо) та виконання необхідних завдань конфігурації для перетворення його на унікальний, готовий до роботи сервер.

Він буквально знаходиться в центрі процесу налаштування, інтерпретуючи **метадані** та **визначені користувачем інструкції** для налаштування системи. Без нього ваш хмарний екземпляр — це просто чудово скомпільоване ядро ​​Linux з кризою ідентичності.

### Екосистема хмарної ініціалізації

cloud-init — це споживач, а не творець. Він покладається на базову хмарну платформу (AWS, Azure, GCP, OpenStack або локальні інструменти, такі як libvirt), щоб отримати інформацію про конфігурацію.

- **Хмарні постачальники** надають дані через спеціалізоване _джерело даних_ (часто локальну кінцеву точку HTTP, певну мітку диска або параметр ядра).
- **cloud-init** виявляє це джерело даних, зчитує конфігурацію та виконує відповідні кроки налаштування.

Таке роз'єднання, коли образ є універсальним, а конфігурація надається ззовні, є фундаментальною суттю всієї моделі розгортання хмари.

## 2. Rocky Linux 10 та загальний хмарний образ

Для цього посібника ми використовуватимемо офіційний файл [Rocky-10-GenericCloud-Base.latest.x86_64.qcow2](https://dl.rockylinux.org/pub/rocky/10/images/x86_64/Rocky-10-GenericCloud-Base.latest.x86_64.qcow2).

### Цільове зображення: робоча конячка з попередньою проводкою

Цей образ особливий, оскільки він містить попередньо встановлений та ввімкнений пакет cloud-init. Його було _узагальнено_, тобто всі ідентифікатори, специфічні для машини, ключі хоста SSH та файли журналів видалено. Він готовий отримати свою нову ідентичність під час першого завантаження.

!!! warning "Використайте рекомендоване зображення"

    Якщо ви спробуєте використати cloud-init на стандартній установці Rocky Linux (наприклад, мінімальній установці ISO), ви виявите, що його немає за замовчуванням. Дотримуйтесь **Загального образу Cloud**, щоб уникнути зайвих складнощів і переконатися, що все працює саме так, як призначив лікар. Спроба виконати вправи з цього посібника з іншими образами, ймовірно, не вдасться і не підтримується.

### Основні концепції: Дані користувача проти метаданих

Інформацію про конфігурацію, яку обробляє cloud-init, поділяють на два ключові типи. Розуміння цієї відмінності є критично важливим для того, щоб знати, що можете контролювати ви, а що контролює постачальник хмарних послуг.

Уявіть собі це як будівництво будинку: **Метадані** – це адреса вулиці, призначена містом, а **Дані користувача** – це креслення, яке ви надаєте для дизайну інтер’єру.

| Тип даних     | Джерело та мета                                                                                                                                                                                                                                            | Тип конфігурації         |
| :------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------- |
| **Meta-Data** | Надається хмарною платформою (лише для читання). Містить системні ідентифікатори, такі як ідентифікатор екземпляра, ім'я хоста (якщо надано платформою), регіон та зона доступності. | _Системний контекст_     |
| **User-Data** | Надано користувачем. Це ваш набір інструкцій — блоки конфігурації YAML або скрипти оболонки, які налаштовують сервер.                                                                                                      | _Інструкції користувача_ |

**Метадані** повідомляють cloud-init, _де_ вони знаходяться. **Дані користувача** повідомляють cloud-init, _що робити_.

Ми зосередимося, головним чином, на створенні ефективних файлів **User-Data**, які зазвичай починаються з обов'язкового заголовка YAML:

```yaml
#cloud-config
```

## 3. Життєвий цикл: чотири етапи ініціалізації cloud-init

Cloud-init не просто запускає скрипт і завершує роботу; він виконує серію чітко структурованих етапів, які відповідають процесу завантаження сервера. Такий методичний підхід гарантує виконання залежностей (наприклад, мережа налаштовується до завантаження пакетів).

Розуміння цього життєвого циклу є критично важливим для налагодження та точного знання того, коли виконуються ваші власні інструкції.

| Етап          | Час та опис                                                                                                                                                                                                                                | Ключові дії/модулі                                                                                                                                                                      |
| :------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Генератор** | Запускається дуже рано в процесі завантаження. Налаштовує внутрішні каталоги та виконує базові перевірки конфігурації.                                                                                     | Внутрішнє налаштування, ініціалізація журналу.                                                                                                                          |
| **Local**     | Обов'язково виконується до того, як мережа запрацює. Він обробляє локальні джерела даних, такі як CD-ROM або віртуальні диски (які ми використовуватимемо в нашій лабораторній роботі). | Встановлення імені хоста з локальних даних, початкове налаштування диска.                                                                                               |
| **Мережа**    | Запускається після повного налаштування та працездатності мережі. Він запитує мережеві джерела даних (наприклад, API постачальника хмарних послуг).                                     | Налаштовувати мережеві інтерфейси, отримувати ключі з мережевих метаданих.                                                                                              |
| **Final**     | Запускається останнім. Саме тут відбувається більшість користувацьких налаштувань, оскільки всі передумови (користувачі, мережа, диски) тепер готові.                                   | Встановлення пакетів, запуск користувацьких скриптів (runcmd), запис файлів (write_files), очищення системи. |

!!! tip "Перевірте журнали"

    Під час усунення несправностей завжди перевіряйте `/var/log/cloud-init.log`. Цей файл є звітом про процес `cloud-init`, який точно показує, коли кожен етап почався та завершився, а також які модулі виконувалися на цьому шляху. Якщо ваш скрипт не запустився, у журналі буде точно зазначено причину та який етап завершився невдачею.

## Що далі

Тепер, коли ви розумієте фундаментальну архітектуру `cloud-init` — «що» і «чому», різні типи даних та етапи завантаження — ви готові перейти від теорії до практики. У наступному розділі ви пройдете першу практичну вправу: завантаження хмарного образу Rocky Linux 10 та виконання простого налаштування для реального середовища.
