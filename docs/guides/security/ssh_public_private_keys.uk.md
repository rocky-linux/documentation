---
title: Відкритий і закритий ключ SSH
author: Steven Spencer
contributors: Ezequiel Bruni
tested_with: 8.5
tags:
  - безпека
  - ssh
  - keygen
---

# Відкритий і закритий ключ SSH

## Передумови

* Певний комфорт роботи з командного рядка
* Сервери та/або робочі станції Rocky Linux із встановленим *openssh*
    * Технічно цей процес має працювати на будь-якій системі Linux із встановленим openssh
* Додатково: знайомство з дозволами на файли та каталоги Linux

## Вступ

SSH — це протокол для доступу до однієї машини з іншої, як правило, через командний рядок. За допомогою SSH ви можете виконувати команди на віддалених комп’ютерах і серверах, надсилати файли та взагалі керувати всім, що ви робите, з одного місця.

Працюючи з кількома серверами Rocky Linux у різних місцях або намагаючись заощадити час на доступі до цих серверів, ви захочете використовувати пару відкритих і закритих ключів SSH. Пари ключів спрощують вхід на віддалені машини та виконання команд.

Цей документ допоможе вам створити ключі та налаштувати сервери для легкого доступу за допомогою цих ключів.

## Процес генерації ключів

Усі наступні команди виконуються з командного рядка вашої робочої станції Rocky Linux:

```
ssh-keygen -t rsa
```

Що відображатиме наступне:

```
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
```

Натисніть Enter, щоб прийняти розташування за замовчуванням. Далі система покаже:

`Enter passphrase (empty for no passphrase):`

Тож просто натисніть Enter тут. Нарешті він попросить вас повторно ввести парольну фразу:

`Enter same passphrase again:`

Тож натисніть Enter востаннє.

Тепер у вашому каталозі .ssh має бути пара відкритих і закритих ключів типу RSA:

```
ls -a .ssh/
.  ..  id_rsa  id_rsa.pub
```

Тепер нам потрібно надіслати відкритий ключ (id_rsa.pub) на кожну машину, до якої ми матимемо доступ... але перед тим, як це зробити, нам потрібно переконатися, що ми можемо підключатися через SSH до серверів, на які ми будемо надсилати ключ. Для нашого прикладу ми будемо використовувати лише три сервери.

Ви можете отримати доступ до них через SSH за допомогою імені DNS або IP-адреси, але ми будемо використовувати ім’я DNS для нашого прикладу. Наші приклади серверів: web, mail, та portal. Для кожного сервера ми спробуємо підключитися до SSH (ботаніки люблять використовувати SSH як дієслово) і залишимо відкритим вікно терміналу для кожної машини:

`ssh -l root web.ourourdomain.com`

Якщо припустити, що ми можемо без проблем увійти на всіх трьох машинах, тоді наступним кроком буде відправка нашого відкритого ключа на кожен сервер:

`scp .ssh/id_rsa.pub root@web.ourourdomain.com:/root/`

Повторіть цей крок з кожною з наших трьох машин.

Тепер у кожному відкритому вікні терміналу ви зможете побачити *id_rsa.pub*, коли введете таку команду:

`ls -a | grep id_rsa.pub`

Якщо так, тепер ми готові або створити, або додати файл *authorized_keys* у каталозі *.ssh* кожного сервера. На кожному з серверів введіть цю команду:

`ls -a .ssh`

!!! warning "Важливо!"

    Переконайтеся, що ви уважно прочитали все нижче. Якщо ви не впевнені, що щось зламаєте, створіть резервну копію authorized_keys (якщо вона існує) на кожній машині, перш ніж продовжувати.

Якщо в списку немає файлу *authorized_keys*, ми створимо його, ввівши цю команду в _/root_ каталог:

`cat id_rsa.pub > .ssh/authorized_keys`

Якщо _authorized_keys_ існує, тоді ми просто хочемо додати наш новий відкритий ключ до тих, які вже є:

`cat id_rsa.pub >> .ssh/authorized_keys`

Після того, як ключ буде додано до _authorized_keys_, або файл _authorized_keys_ створено, спробуйте SSH з вашу робочу станцію Rocky Linux знову на сервер. Ви не повинні запитувати пароль.

Переконавшись, що ви можете входити через SSH без пароля, видаліть файл id_rsa.pub із каталогу _/root_ на кожній машині.

`rm id_rsa.pub`

## Безпека каталогу SSH і authorized_keys

Переконайтеся, що на кожній із ваших цільових машин застосовано такі дозволи:

```
chmod 700 .ssh/
chmod 600 .ssh/authorized_keys
```
